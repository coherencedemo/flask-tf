{% extends "base.tf.j2" %}

{% block environment_resources %}
{{ super() }}

resource "google_storage_bucket" "custom_bucket" {
  name     = "custom-bucket-{{ environment.name }}-{{ env_collection.account_id }}"
  location = "{{ env_collection.region }}"
  force_destroy = true
}

resource "google_storage_bucket_iam_member" "member" {
  bucket = google_storage_bucket.custom_bucket.name
  role   = "roles/storage.objectAdmin"
  member = "serviceAccount:${data.google_project.project.number}@cloudbuild.gserviceaccount.com"
}

output "custom_bucket_name" {
  value = google_storage_bucket.custom_bucket.name
}
{% endblock %}